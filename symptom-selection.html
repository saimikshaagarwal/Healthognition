<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Healthognition - Symptom Selection</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f8fa;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      background: white;
      padding: 30px 40px;
      margin: 40px 20px;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
      max-width: 700px;
      width: 100%;
      box-sizing: border-box;
    }

    h1, h2 {
      color: #2c3e50;
    }

    h2 {
      margin-top: 25px;
      font-size: 1.2rem;
    }

    p {
      margin-bottom: 20px;
      color: #34495e;
    }

    /* dropdown menu */
    select {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      margin-top: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    /* Makes image clickable */
    #body-map {
      max-width: 300px;
      margin: 15px 0;
      cursor: pointer;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    /* Adds spacing above the group of checkboxes. */
    .symptom-options {
      margin-top: 10px;
    }

    /* Each checkbox + label gets some spacing below it. */
    .symptom-options div {
      margin-bottom: 8px;
    }

    /* Enlarges the checkboxes a bit.Adds space between checkbox and label. */
    .symptom-options input[type="checkbox"] {
      transform: scale(1.1);
      margin-right: 10px;
    }

    /* voice input area. */
    #voice-input {
      margin-top: 10px;
      border: 1px solid #ccc;
      padding: 10px;
      width: 100%;
      min-height: 60px;
      font-size: 1rem;
      border-radius: 4px;
      background: #fafafa;
    }

    /* Microphone button */
    #mic-btn {
      margin-top: 10px;
      padding: 10px 15px;
      font-size: 1rem;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #mic-btn:hover {
      background-color: #2980b9;
    }

    #buttons-container {
      margin-top: 25px;
      display: flex;
      justify-content: space-between;
    }

    /* styling for both Next and Reset buttons */
    #next-btn, #reset-btn {
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #next-btn {
      background-color: #2ecc71;
      color: white;
    }

    #next-btn:hover {
      background-color: #27ae60;
    }

    #reset-btn {
      background-color: #e74c3c;
      color: white;
    }

    #reset-btn:hover {
      background-color: #c0392b;
    }

    small {
      color: #7f8c8d;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Symptom Selection</h1>

    <p>Please select your symptoms by any method below. At least one symptom input is required.</p>

    <!-- Creates a section for manual selection with a subtitle.-->
    <section>
      <h2>Manual Symptom Selection</h2>
      <!-- A dropdown list where you can select multiple symptoms (holds up to 6 visible at once). -->
      <select id="manual-symptoms" multiple size="6">
        <!-- Each symptom is listed as an option in the dropdown. -->
        <option value="Headache">Headache</option>
        <option value="Fever">Fever</option>
        <option value="Cough">Cough</option>
        <option value="Fatigue">Fatigue</option>
        <option value="Chest Pain">Chest Pain</option>
        <option value="Shortness of Breath">Shortness of Breath</option>
        <option value="Nausea">Nausea</option>
        <option value="Dizziness">Dizziness</option>
        <option value="Back Pain">Back Pain</option>
        <option value="Muscle Ache">Muscle Ache</option>
        <option value="Neck Pain">Neck Pain</option>
        <option value="Stiffness">Stiffness</option>
        <option value="Leg Pain">Leg Pain</option>
        <option value="Cramps">Cramps</option>
        <option value="Foot Pain">Foot Pain</option>
        <option value="Swelling">Swelling</option>
        <option value="Hand Pain">Hand Pain</option>
        <option value="Numbness">Numbness</option>
        <option value="Stomach Pain">Stomach Pain</option>
      </select>
    </section>

    <section>
      <h2>Select Symptoms by Body Part</h2>
      <!-- Displays the human body image. The usemap links to clickable regions. -->
      <img
        src="https://img.freepik.com/free-vector/human-anatody-white-background_1308-68254.jpg"
        alt="Human Body"
        id="body-map"
        usemap="#bodymap"
        width="143"
        height="356"
      />
      <!-- Each area marks a clickable part of the image. When clicked, it shows related symptoms -->
      <map name="bodymap">
        <area shape="circle" coords="72,30,18" alt="Head" data-symptoms="Headache,Dizziness" />
        <area shape="rect" coords="62,48,82,65" alt="Neck" data-symptoms="Neck Pain,Stiffness" />
        <area shape="rect" coords="55,66,88,100" alt="Chest" data-symptoms="Chest Pain,Shortness of Breath" />
        <area shape="rect" coords="55,100,88,140" alt="Abdomen" data-symptoms="Nausea,Stomach Pain" />
        <area shape="rect" coords="30,66,54,140" alt="Left Arm" data-symptoms="Muscle Ache,Numbness" />
        <area shape="rect" coords="89,66,113,140" alt="Right Arm" data-symptoms="Muscle Ache,Numbness" />
        <area shape="rect" coords="50,140,65,315" alt="Left Leg" data-symptoms="Leg Pain,Cramps" />
        <area shape="rect" coords="68,140,83,315" alt="Right Leg" data-symptoms="Leg Pain,Cramps" />
        <area shape="rect" coords="50,315,68,345" alt="Left Foot" data-symptoms="Foot Pain,Swelling" />
        <area shape="rect" coords="72,315,90,345" alt="Right Foot" data-symptoms="Foot Pain,Swelling" />
        <area shape="rect" coords="20,100,29,140" alt="Left Hand" data-symptoms="Hand Pain,Numbness" />
        <area shape="rect" coords="114,100,123,140" alt="Right Hand" data-symptoms="Hand Pain,Numbness" />
      </map>
      <!-- Placeholder div where checkboxes for symptoms (based on clicked body part) will appear. -->
      <div class="symptom-options" id="body-symptom-options"></div>
    </section>


    <section>
      <!-- The user click the mic button and speak their symptoms. The spoken text shows up in the editable div -->
      <h2>Voice Input</h2>
      <button id="mic-btn">ðŸŽ¤ Start Recording</button>
      <div id="voice-input" contenteditable="true" aria-label="Voice input text area"></div>
      <small>Speak your symptoms and they will appear here.</small>
    </section>

    <!-- "Next" stores selections and moves to the next page; "Reset" clears all input. -->
    <div id="buttons-container">
      <button id="next-btn">Next</button>
      <button id="reset-btn">Reset</button>
    </div>
  </div>

  <script>
    // Stores elements for manual selection, body-based options, microphone button, and voice text box.
    const manualSelect = document.getElementById("manual-symptoms");
    const symptomOptionsDiv = document.getElementById("body-symptom-options");
    const micBtn = document.getElementById("mic-btn");
    const voiceInputDiv = document.getElementById("voice-input");
    //recognition will handle speech input. isRecording tracks whether the mic is on.
    let recognition;
    let isRecording = false;

    //recognition will handle speech input. isRecording tracks whether the mic is on.
    window.addEventListener("DOMContentLoaded", () => {
      const savedSymptoms = JSON.parse(localStorage.getItem("symptoms") || "{}");

      //Restore previously selected manual symptoms.
      //Show checkboxes for previously selected body-part symptoms.
      // Restore voice input text if available.
      if (savedSymptoms.manual) {
        Array.from(manualSelect.options).forEach(option => {
          option.selected = savedSymptoms.manual.includes(option.value);
        });
      }

      if (savedSymptoms.body) {
        showBodySymptomOptions(savedSymptoms.body);
      }

      if (savedSymptoms.voice) {
        voiceInputDiv.textContent = savedSymptoms.voice;
      }
    });

    //When a body area is clicked, prevent the default browser action and show related symptoms as checkboxes.
    document.querySelectorAll("area").forEach(area => {
      area.addEventListener("click", (e) => {
        e.preventDefault();
        const symptoms = e.target.getAttribute("data-symptoms").split(",");
        showBodySymptomOptions(symptoms);
      });
    });

    //Clear previous symptoms and get saved ones to pre-check if needed.
    function showBodySymptomOptions(symptomsArr) {
      symptomOptionsDiv.innerHTML = "";
      const saved = JSON.parse(localStorage.getItem("symptoms") || "{}");
      const savedBody = saved.body || [];

      //Dynamically create checkboxes for each symptom.
      //Attach each checkbox and label to the page.
      symptomsArr.forEach(symptom => {
        const id = "symptom-" + symptom.toLowerCase().replace(/\s+/g, "-");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = id;
        checkbox.name = "body-symptoms";
        checkbox.value = symptom;
        if (savedBody.includes(symptom)) checkbox.checked = true;

        const label = document.createElement("label");
        label.htmlFor = id;
        label.textContent = symptom;

        const div = document.createElement("div");
        div.appendChild(checkbox);
        div.appendChild(label);
        symptomOptionsDiv.appendChild(div);
      });
    }

    //Check if browser supports speech recognition.
    //Set up a new recognition instance in English.
    if ("webkitSpeechRecognition" in window || "SpeechRecognition" in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.lang = "en-US";

      //When mic starts, update button label.
      recognition.onstart = () => {
        isRecording = true;
        micBtn.textContent = "ðŸ›‘ Stop Recording";
      };
      //Show spoken symptoms in the voice input box.
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript.trim();
        voiceInputDiv.textContent += (voiceInputDiv.textContent ? " " : "") + transcript;
      };

      //Handle errors and stop mic cleanly.
      recognition.onerror = (event) => alert("Speech recognition error: " + event.error);
      recognition.onend = () => {
        isRecording = false;
        micBtn.textContent = "ðŸŽ¤ Start Recording";
      };

      //Toggle mic on button click.
      //If the browser doesn't support speech, disable the mic button.
      micBtn.addEventListener("click", () => {
        isRecording ? recognition.stop() : recognition.start();
      });
    } else {
      micBtn.disabled = true;
      micBtn.textContent = "ðŸŽ¤ Speech Recognition Not Supported";
    }

    //Get selected values from all three input methods.
    document.getElementById("next-btn").addEventListener("click", () => {
      const manual = Array.from(manualSelect.selectedOptions).map(o => o.value);
      const body = Array.from(document.querySelectorAll('input[name="body-symptoms"]:checked')).map(i => i.value);
      const voice = voiceInputDiv.textContent.trim();

      //Show an alert if nothing is selected.
      if (manual.length === 0 && body.length === 0 && voice === "") {
        alert("Please provide symptoms using at least one input method.");
        return;
      }

      //Save all input into localStorage and go to the results page.
      localStorage.setItem("symptoms", JSON.stringify({ manual, body, voice }));
      window.location.href = "results.html";
    });

    //Deselect all manual options, remove body/voice input, and clear local storage.
    document.getElementById("reset-btn").addEventListener("click", () => {
      Array.from(manualSelect.options).forEach(opt => opt.selected = false);
      symptomOptionsDiv.innerHTML = "";
      voiceInputDiv.textContent = "";
      localStorage.removeItem("symptoms");
    });
  </script>
</body>
</html>
